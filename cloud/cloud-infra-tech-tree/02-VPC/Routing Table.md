# Routing Table

- 서브넷 또는 게이트웨이의 네트워크 트래픽이 전송되는 위치를 결정하는 규칙 세트

## Routing Table 개념

- 기본 라우팅 테이블
    - VPC와 함께 제공되는 라우팅 테이블
    - 다른 라우팅 테이블과 명시적으로 연결되지 않은 모든 서브넷의 라우팅을 제어
- 사용자 지정 라우팅 테이블 (Custom route table)
    - VPC에 대해 생성하는 라우팅 테이블
- 대상 (Destination)
    - 트래픽을 이동할 대상 IP 주소(대상 CIDR)의 범위
- 대상 (Target)
    - 대상 트래픽을 전송할 때 사용할 게이트웨이, 네트워크 인터페이스 또는 연결 (ex : 인터넷 게이트웨이)
- 라우팅 테이블 연결 (Route Table Association)
    - 라우팅 테이블과 서브넷, 인터넷 게이트웨이 또는 가상 프라이빗 게이트웨이 간의 연결
- 서브넷 라우팅 테이블(Subnet route table)
    - 서브넷과 연결된 라우팅 테이블
- 로컬 라우팅
    - VPC 내 통신을 위한 기본 라우팅
- 전파 (Propagation)
    - 라우팅 전파를 사용하면 가상 프라이빗 게이트웨이가 라우팅 테이블에 라우팅 테이블에 라우팅을 자동으로 전파할 수 있다 → 라우팅 테이블에 VPN 라우팅을 수동으로 입력할 필요가 없다는 뜻
- 게이트웨이 라우팅 테이블 (Gateway route table)
    - 인터넷 게이트웨이 또는 가상 프라이빗 게이트웨이와 연결된 라우팅 테이블
- 엣지 연결 (Edge association)
    - 인바운드 VPC 트래픽을 어플라이언스로 라우팅하는 데 사용하는 라우팅 테이블
    - 라우팅 테이블을 인터넷 게이트웨이 또는 가상 프라이빗 게이트웨이와 연결하고 어플라이언스의 네트워크 인터페이스를 VPC 트래픽의 대상으로 지정
- Transit 게이트웨이 라우팅 테이블
    - Transit 게이트웨이와 연결된 라우팅 테이블
- 로컬 게이트웨이 라우팅 테이블
    - Outposts 로컬 게이트웨이와 연결된 라우팅 테이블

## 서브넷 라우팅 테이블

VPC에는 암시적 라우터가 있으며 라우팅 테이블을 사용하여 **네트워크 트래픽을 전달되는 위치를 제어**

VPC의 각 서브넷을 라우팅 테이블에 연결해야 하고, 테이블에서는 서브넷에 대한 라우팅을 제어

서브넷은 한 번에 하나의 라우팅 테이블에만 연결할 수 있지만 여러 서브넷에서 동일한 서브넷 라우팅 테이블에 연결할 수 있다

### Routing

- 테이블의 각 라우팅은 목적지 및 대상을 지정
    - 서브넷이 인터넷 게이트웨이를 통해 인터넷에 액세스할 수 있도록 하려면 서브넷 라우팅 테이블에 아래와 같이 라우팅 추가
    
    | 대상 주소 | 대상 |
    | --- | --- |
    | 0.0.0.0/0
    (모든 IPv4 주소) | igw-id
    (VPC에 연결된 인터넷 게이트웨이) |
    - IPv4와 IPv6은 별도로 취급되기 때문에 IPv6 대상도 추가하려면 `::/0` 라우팅도 추가해야 한다
- AWS 리소스 전체에서 동일한 CIDR 블록 세트를 자주 참조하는 경우, 고객 관리형 접두사 목록을 생성하여 그룹화할 수 있다 → 접두사 목록을 라우팅 테이블 대상으로 지정
- 모든 라우팅 테이블에는 VPC 내부 통신을 위한 로컬 라우팅이 포함
    - 로컬 라우팅은 기본적으로 모든 라우팅 테이블에 추가
- VPC에 하나 이상의 IPv4 CIDR 블록이 연결되어 있는 경우, 라우팅 테이블에 각 IPv4 CIDR 블록의 로컬 경로가 포함
- 마찬가지로, VPC에 하나 이상의 IPv6 CIDR 블록이 연결되어 있는 경우, 라우팅 테이블에 각 IPv6 CIDR 블록의 로컬 경로가 포함
- 필요에 따라 각 로컬 라우팅의 대상을 교체하거나 복원할 수 있다

## 기본 라우팅 테이블

- VPC를 만들면 기본 라우팅 테이블이 자동으로 생성
- 서브넷이 라우팅 테이블과 명시적으로 연결되지 않은 경우, 서브넷은 기본 라우팅 테이블이 기본적으로 사용된다
- 기본 라우팅 테이블의 규칙
    - 기본 라우팅 테이블은 삭제할 수 없다
    - 게이트웨이 라우팅 테이블을 기본 라우팅 테이블로 설정할 수 없다
    - 기본 라우팅 테이블을 사용자 지정 서브넷 라우팅 테이블로 바꿀 수 있다
    - 기본 라우팅 테이블에서 라우팅을 추가 및 제거하고 수정할 수 있다
    - 서브넷이 기본 라우팅 테이블에 명시적으로 연결되어 있지 않을 경우에도 서브넷을 기본 라우팅에 명시적으로 연결할 수 있다

## 사용자 지정 라우팅 테이블

- 사용자의 필요에 따라 라우팅을 추가
- (ex) VPC 생성 항목 중 퍼블릭 서브넷을 선택하면 AWS VPC가 사용자 지정 라우팅 테이블을 만들고 인터넷 게이트웨이를 가리키는 주소를 추가한다
- 메인 라우팅 테이블을 기본값 상태로 남기고, 새로운 서브넷에 사용자 지정 라우팅 테이블을 연결할 것 → VPC 보안을 위해
- 사용자 지정 라우팅 테이블에 연결이 없을 때만 삭제가 가능

[VPC의 서브넷 - Amazon Virtual Private Cloud](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/configure-subnets.html)